!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("jquery"),require("knockout")):"function"==typeof define&&define.amd?define(["jquery","knockout"],a):a($,ko)}(function(a,b){function c(b,c){var d=a("<div class='view-container'></div>");return d.css("position","absolute"),d.height(c+"px"),d.width("100%"),d}function d(b,c){var d=a("<div class='item-container'></div>");return d.css("position","relative"),d.height(b*c+"px"),d.width("100%"),d}function e(a,c){for(var d=b.virtualElements.childNodes(a),e=d.length-1;e>=0;e--)c.append(d[e])}var f=b.utils.unwrapObservable,g=b.bindingHandlers.foreach.init,h=b.bindingHandlers.foreach.update;b.bindingHandlers.foreach=a.extend(b.bindingHandlers.foreach,{init:function(i,j,k,l,m){if(k().lazy){var n=k().lazy.itemHeight,o=f(j().data)||f(j()),p=a("#comment"==i.nodeName?i.parentNode:i),q=d(n,o.length),r=c(p.height());e(i,r),b.virtualElements.emptyNode(i),b.virtualElements.prepend(i,q[0]),b.virtualElements.prepend(q[0],r[0]);var s={scrollTop:b.observable(0),list:o,visibleList:b.observable([]),$itemContainer:q,$viewContainer:r,elementHeight:n,$viewport:p,render:function(){var a=this.$viewport.scrollTop(),b=this.$viewport.height(),c=Math.floor(a/n)*n,d=c/n,e=Math.ceil((c+b)/n);this.visibleList(o.slice(d,e)),h.apply(this,[r[0],s.valueAccessor,k,l,m]),r.css("top",d*n+"px")},valueAccessor:function(){var a=j();return a.data?a.data=s.visibleList:a=s.visibleList,a}};return s.scrollTopDelayed=b.computed(function(){return s.scrollTop()}),k().lazy.throttle&&(s.scrollTopDelayed=s.scrollTopDelayed.extend({throttle:k().lazy.throttle})),g.apply(this,[r[0],s.valueAccessor,k,l,m]),s.scrollTopDelayed.subscribe(function(){s.render()}),s.$viewport.scroll(function(){s.scrollTop(s.$viewport.scrollTop())}),s.render(),{controlsDescendantBindings:!0}}return g.apply(this,arguments)},update:function(a,b,c){return c().lazy?void 0:h.apply(this,arguments)}})});